(my_project) jinfang@user-MZ72-HB2-00:~/project/new_CarotidPlaqueStabilityClassification$ ./train_mask.sh
使用设备: cuda
✓ 随机种子设置为: 42

✓ 创建输出文件夹: ./output_mask/train_mask_20251223_200307


============================================================
加载数据集（含Mask）...
============================================================
跳过 孙宝忠: 不在标签文件中
跳过 谢岐山: 不在标签文件中
跳过 陈会友: 不在标签文件中
跳过 朱岳平: 不在标签文件中
跳过 眭卫国: 不在标签文件中
============================================================
数据加载统计 (含Mask):
============================================================
✓ 成功加载: 380 个样本
✗ 跳过样本: 2 个 (图片数 < 100)
✗ 缺少Mask: 0 个
每个样本保留: 100 张图片

跳过的样本详情:
  ✗ 王翠霞            :   96 张 | Label: 1
  ✗ 赵明庚            :   67 张 | Label: 0

类别分布: Label 0: 209 个  Label 1: 171 个  
============================================================

数据集划分:
  训练集: 304 样本
  验证集: 38 样本
  测试集: 38 样本

============================================================
保存数据集样本名称...
============================================================
✓ 训练集样本已保存: ./output_mask/train_mask_20251223_200307/logs/train_samples.csv (304 样本)
✓ 验证集样本已保存: ./output_mask/train_mask_20251223_200307/logs/val_samples.csv (38 样本)
✓ 测试集样本已保存: ./output_mask/train_mask_20251223_200307/logs/test_samples.csv (38 样本)
============================================================


============================================================
创建Mask引导模型...
============================================================
正在加载预训练模型: ./weights/resnet_18_23dataset.pth
✓ 成功加载 102 个预训练权重
冻结骨干网络参数...
✓ 冻结了 60 个参数
可训练参数: 165,250 / 33,325,250 (0.50%)
类别分布: 负类=169, 正类=135
基础权重: [0.8994082840236687, 1.125925925925926]
最终权重: [0.8994083 1.351111 ] (neg_scale=1.0, pos_scale=1.2)

============================================================
评估第0轮（初始）性能...
============================================================
第0轮（初始）:
  训练集 Loss: 57.7412
  验证集 Loss: 65.6483
  验证集 Acc:  0.4737
============================================================


============================================================
开始训练...
============================================================


Epoch 1/40
------------------------------------------------------------

训练 - Loss: 6.0441, Acc: 0.4375
验证 - Loss: 1.2770, Acc: 0.4737, F1: 0.0000, AUC: 0.3556
测试（本轮） - Acc: 0.5789, F1: 0.0000, AUC: 0.4602, Recall: 0.0000, Precision: 0.0000
✓ 保存最佳模型 (验证准确率: 0.4737)

Epoch 2/40
------------------------------------------------------------

训练 - Loss: 4.0590, Acc: 0.5132
验证 - Loss: 1.0294, Acc: 0.5789, F1: 0.6923, AUC: 0.6944
测试（本轮） - Acc: 0.4474, F1: 0.5532, AUC: 0.5341, Recall: 0.8125, Precision: 0.4194
✓ 保存最佳模型 (验证准确率: 0.5789)

Epoch 3/40
------------------------------------------------------------

训练 - Loss: 3.7836, Acc: 0.5066
验证 - Loss: 2.0294, Acc: 0.4737, F1: 0.4737, AUC: 0.4528
测试（本轮） - Acc: 0.5263, F1: 0.3571, AUC: 0.4432, Recall: 0.3125, Precision: 0.4167

Epoch 4/40
------------------------------------------------------------

训练 - Loss: 3.3228, Acc: 0.4276
验证 - Loss: 1.1662, Acc: 0.5000, F1: 0.3871, AUC: 0.4833
测试（本轮） - Acc: 0.6053, F1: 0.6154, AUC: 0.6136, Recall: 0.7500, Precision: 0.5217

Epoch 5/40
------------------------------------------------------------

训练 - Loss: 2.6700, Acc: 0.5559
验证 - Loss: 1.5733, Acc: 0.5263, F1: 0.6087, AUC: 0.5389
测试（本轮） - Acc: 0.4211, F1: 0.3529, AUC: 0.4148, Recall: 0.3750, Precision: 0.3333

Epoch 6/40
------------------------------------------------------------

训练 - Loss: 2.9639, Acc: 0.4803
验证 - Loss: 0.8271, Acc: 0.5526, F1: 0.6909, AUC: 0.5333
测试（本轮） - Acc: 0.5263, F1: 0.6250, AUC: 0.6165, Recall: 0.9375, Precision: 0.4688

Epoch 7/40
------------------------------------------------------------

训练 - Loss: 2.4043, Acc: 0.4934
验证 - Loss: 1.0008, Acc: 0.6053, F1: 0.6809, AUC: 0.5306
测试（本轮） - Acc: 0.5000, F1: 0.4571, AUC: 0.4347, Recall: 0.5000, Precision: 0.4211
✓ 保存最佳模型 (验证准确率: 0.6053)

Epoch 8/40
------------------------------------------------------------

训练 - Loss: 1.6985, Acc: 0.5230
验证 - Loss: 0.8710, Acc: 0.4474, F1: 0.2222, AUC: 0.4222
测试（本轮） - Acc: 0.5000, F1: 0.0952, AUC: 0.4432, Recall: 0.0625, Precision: 0.2000

Epoch 9/40
------------------------------------------------------------

训练 - Loss: 1.5928, Acc: 0.5888
验证 - Loss: 1.1113, Acc: 0.5000, F1: 0.2963, AUC: 0.3944
测试（本轮） - Acc: 0.6316, F1: 0.5000, AUC: 0.5824, Recall: 0.4375, Precision: 0.5833

Epoch 10/40
------------------------------------------------------------

训练 - Loss: 1.7963, Acc: 0.4770
验证 - Loss: 0.9131, Acc: 0.4474, F1: 0.4615, AUC: 0.4222
测试（本轮） - Acc: 0.5263, F1: 0.4706, AUC: 0.5824, Recall: 0.5000, Precision: 0.4444

Epoch 11/40
------------------------------------------------------------

训练 - Loss: 1.3089, Acc: 0.5000
验证 - Loss: 0.7521, Acc: 0.5526, F1: 0.6047, AUC: 0.5861
测试（本轮） - Acc: 0.6842, F1: 0.6250, AUC: 0.6648, Recall: 0.6250, Precision: 0.6250

Epoch 12/40
------------------------------------------------------------

训练 - Loss: 1.1958, Acc: 0.5230
验证 - Loss: 0.7499, Acc: 0.5263, F1: 0.6667, AUC: 0.3944
测试（本轮） - Acc: 0.5000, F1: 0.5778, AUC: 0.6278, Recall: 0.8125, Precision: 0.4483

Epoch 13/40
------------------------------------------------------------

训练 - Loss: 1.2331, Acc: 0.5362
验证 - Loss: 0.9629, Acc: 0.3421, F1: 0.3590, AUC: 0.3556
测试（本轮） - Acc: 0.6053, F1: 0.5946, AUC: 0.6108, Recall: 0.6875, Precision: 0.5238

Epoch 14/40
------------------------------------------------------------

训练 - Loss: 1.1114, Acc: 0.5263
验证 - Loss: 0.6760, Acc: 0.6316, F1: 0.7083, AUC: 0.5500
测试（本轮） - Acc: 0.5789, F1: 0.6000, AUC: 0.6023, Recall: 0.7500, Precision: 0.5000
✓ 保存最佳模型 (验证准确率: 0.6316)

Epoch 15/40
------------------------------------------------------------

训练 - Loss: 0.9826, Acc: 0.5329
验证 - Loss: 0.8941, Acc: 0.3684, F1: 0.2500, AUC: 0.3083
测试（本轮） - Acc: 0.5263, F1: 0.2500, AUC: 0.4290, Recall: 0.1875, Precision: 0.3750

Epoch 16/40
------------------------------------------------------------

训练 - Loss: 0.9811, Acc: 0.5066
验证 - Loss: 0.7149, Acc: 0.5263, F1: 0.6538, AUC: 0.5333
测试（本轮） - Acc: 0.3947, F1: 0.4390, AUC: 0.4631, Recall: 0.5625, Precision: 0.3600

Epoch 17/40
------------------------------------------------------------

训练 - Loss: 0.9496, Acc: 0.5263
验证 - Loss: 0.6541, Acc: 0.6316, F1: 0.7308, AUC: 0.6778
测试（本轮） - Acc: 0.4737, F1: 0.5455, AUC: 0.6250, Recall: 0.7500, Precision: 0.4286

Epoch 18/40
------------------------------------------------------------

训练 - Loss: 1.0149, Acc: 0.4704
验证 - Loss: 0.6939, Acc: 0.4737, F1: 0.5455, AUC: 0.4917
测试（本轮） - Acc: 0.5000, F1: 0.3448, AUC: 0.5057, Recall: 0.3125, Precision: 0.3846

Epoch 19/40
------------------------------------------------------------

训练 - Loss: 0.8611, Acc: 0.5033
验证 - Loss: 0.6683, Acc: 0.6053, F1: 0.6667, AUC: 0.6444
测试（本轮） - Acc: 0.5789, F1: 0.5556, AUC: 0.6278, Recall: 0.6250, Precision: 0.5000

Epoch 20/40
------------------------------------------------------------

训练 - Loss: 0.8079, Acc: 0.5033
验证 - Loss: 0.6539, Acc: 0.6842, F1: 0.7143, AUC: 0.7417
测试（本轮） - Acc: 0.5789, F1: 0.5000, AUC: 0.5511, Recall: 0.5000, Precision: 0.5000
✓ 保存最佳模型 (验证准确率: 0.6842)

Epoch 21/40
------------------------------------------------------------

训练 - Loss: 0.9245, Acc: 0.4704
验证 - Loss: 0.6810, Acc: 0.5263, F1: 0.6087, AUC: 0.5861
测试（本轮） - Acc: 0.5000, F1: 0.4865, AUC: 0.6108, Recall: 0.5625, Precision: 0.4286

Epoch 22/40
------------------------------------------------------------

训练 - Loss: 0.8309, Acc: 0.5329
验证 - Loss: 0.6962, Acc: 0.5789, F1: 0.6522, AUC: 0.5111
测试（本轮） - Acc: 0.6316, F1: 0.5000, AUC: 0.5767, Recall: 0.4375, Precision: 0.5833

Epoch 23/40
------------------------------------------------------------

训练 - Loss: 0.8070, Acc: 0.5230
验证 - Loss: 0.7069, Acc: 0.4474, F1: 0.5333, AUC: 0.4361
测试（本轮） - Acc: 0.6316, F1: 0.5882, AUC: 0.6278, Recall: 0.6250, Precision: 0.5556

Epoch 24/40
------------------------------------------------------------

训练 - Loss: 0.8200, Acc: 0.5395
验证 - Loss: 0.7126, Acc: 0.4737, F1: 0.5455, AUC: 0.4778
测试（本轮） - Acc: 0.5263, F1: 0.3571, AUC: 0.4943, Recall: 0.3125, Precision: 0.4167

Epoch 25/40
------------------------------------------------------------

训练 - Loss: 0.9267, Acc: 0.5033
验证 - Loss: 0.6804, Acc: 0.5789, F1: 0.6522, AUC: 0.6306
测试（本轮） - Acc: 0.5789, F1: 0.5556, AUC: 0.6307, Recall: 0.6250, Precision: 0.5000

Epoch 26/40
------------------------------------------------------------

训练 - Loss: 0.7593, Acc: 0.5757
验证 - Loss: 0.6945, Acc: 0.5263, F1: 0.6087, AUC: 0.5917
测试（本轮） - Acc: 0.5789, F1: 0.5294, AUC: 0.6562, Recall: 0.5625, Precision: 0.5000

Epoch 27/40
------------------------------------------------------------

训练 - Loss: 0.7870, Acc: 0.5099
验证 - Loss: 0.7197, Acc: 0.5526, F1: 0.6383, AUC: 0.5389
测试（本轮） - Acc: 0.5263, F1: 0.3571, AUC: 0.4460, Recall: 0.3125, Precision: 0.4167

Epoch 28/40
------------------------------------------------------------

训练 - Loss: 0.7835, Acc: 0.5789
验证 - Loss: 0.7238, Acc: 0.4737, F1: 0.5238, AUC: 0.5361
测试（本轮） - Acc: 0.5263, F1: 0.3077, AUC: 0.4119, Recall: 0.2500, Precision: 0.4000

Epoch 29/40
------------------------------------------------------------

训练 - Loss: 0.7932, Acc: 0.5493
验证 - Loss: 0.7148, Acc: 0.4211, F1: 0.5000, AUC: 0.5000
测试（本轮） - Acc: 0.5263, F1: 0.3077, AUC: 0.4205, Recall: 0.2500, Precision: 0.4000

Epoch 30/40
------------------------------------------------------------

训练 - Loss: 0.7319, Acc: 0.5658
验证 - Loss: 0.7040, Acc: 0.5000, F1: 0.5778, AUC: 0.5222
测试（本轮） - Acc: 0.5000, F1: 0.2963, AUC: 0.4403, Recall: 0.2500, Precision: 0.3636

Epoch 31/40
------------------------------------------------------------

训练 - Loss: 0.7805, Acc: 0.5296
验证 - Loss: 0.7103, Acc: 0.5263, F1: 0.5909, AUC: 0.5583
测试（本轮） - Acc: 0.5000, F1: 0.2963, AUC: 0.3920, Recall: 0.2500, Precision: 0.3636

Epoch 32/40
------------------------------------------------------------

训练 - Loss: 0.7807, Acc: 0.4868
验证 - Loss: 0.7362, Acc: 0.4211, F1: 0.4762, AUC: 0.4694
测试（本轮） - Acc: 0.5263, F1: 0.3077, AUC: 0.3807, Recall: 0.2500, Precision: 0.4000

Epoch 33/40
------------------------------------------------------------

训练 - Loss: 0.7695, Acc: 0.5428
验证 - Loss: 0.7114, Acc: 0.4474, F1: 0.5116, AUC: 0.4750
测试（本轮） - Acc: 0.5000, F1: 0.2400, AUC: 0.4744, Recall: 0.1875, Precision: 0.3333

Epoch 34/40
------------------------------------------------------------

训练 - Loss: 0.8074, Acc: 0.5329
验证 - Loss: 0.6940, Acc: 0.4737, F1: 0.5455, AUC: 0.4889
测试（本轮） - Acc: 0.4474, F1: 0.2759, AUC: 0.5028, Recall: 0.2500, Precision: 0.3077

Epoch 35/40
------------------------------------------------------------

训练 - Loss: 0.7437, Acc: 0.5428
验证 - Loss: 0.6935, Acc: 0.5526, F1: 0.6383, AUC: 0.5000
测试（本轮） - Acc: 0.4474, F1: 0.2759, AUC: 0.4290, Recall: 0.2500, Precision: 0.3077

Epoch 36/40
------------------------------------------------------------

训练 - Loss: 0.7765, Acc: 0.5559
验证 - Loss: 0.6985, Acc: 0.4474, F1: 0.5333, AUC: 0.5083
测试（本轮） - Acc: 0.5789, F1: 0.4667, AUC: 0.5881, Recall: 0.4375, Precision: 0.5000

Epoch 37/40
------------------------------------------------------------

训练 - Loss: 0.8253, Acc: 0.4901
验证 - Loss: 0.6867, Acc: 0.5000, F1: 0.5957, AUC: 0.5278
测试（本轮） - Acc: 0.5526, F1: 0.4848, AUC: 0.5966, Recall: 0.5000, Precision: 0.4706

Epoch 38/40
------------------------------------------------------------

训练 - Loss: 0.7992, Acc: 0.4967
验证 - Loss: 0.6920, Acc: 0.4211, F1: 0.5000, AUC: 0.4750
测试（本轮） - Acc: 0.5789, F1: 0.4286, AUC: 0.5568, Recall: 0.3750, Precision: 0.5000

Epoch 39/40
------------------------------------------------------------

训练 - Loss: 0.8047, Acc: 0.4704
验证 - Loss: 0.6906, Acc: 0.4737, F1: 0.5455, AUC: 0.5000
测试（本轮） - Acc: 0.4737, F1: 0.3333, AUC: 0.5114, Recall: 0.3125, Precision: 0.3571

Epoch 40/40
------------------------------------------------------------

训练 - Loss: 0.7570, Acc: 0.5132
验证 - Loss: 0.6910, Acc: 0.5000, F1: 0.5581, AUC: 0.4889
测试（本轮） - Acc: 0.5526, F1: 0.3704, AUC: 0.5114, Recall: 0.3125, Precision: 0.4545

✓ 训练历史已保存: ./output_mask/train_mask_20251223_200307/logs/training_history.csv
✓ Loss对比图已保存: ./output_mask/train_mask_20251223_200307/logs/loss_comparison_4views.png

============================================================
Loss改善统计:
============================================================
训练集:
  初始Loss (Epoch 0):    57.7412
  最佳Loss (Epoch 1+):   0.7319
  改善:                  57.0093 (98.7%)

验证集:
  初始Loss (Epoch 0):    65.6483
  最佳Loss (Epoch 1+):   0.6539
  改善:                  64.9944 (99.0%)
============================================================


============================================================
测试集评估...
============================================================

测试集结果:
  准确率: 0.5789
  精确率: 0.5000
  召回率: 0.5000
  F1分数: 0.5000
  AUC:   0.5511

混淆矩阵:
[[14  8]
 [ 8  8]]

============================================================
保存测试集详细预测结果...
============================================================

正在评估测试集每个样本...
  已评估 5/38 个样本
  已评估 10/38 个样本
  已评估 15/38 个样本
  已评估 20/38 个样本
  已评估 25/38 个样本
  已评估 30/38 个样本
  已评估 35/38 个样本

✓ 测试集详细评估完成
  总样本数: 38
  正确预测: 22
  错误预测: 16
  准确率: 0.5789

✓ 详细预测结果已保存: ./output_mask/train_mask_20251223_200307/results/test_predictions_detailed.csv
✓ 错误预测案例已保存: ./output_mask/train_mask_20251223_200307/results/test_predictions_errors.csv

错误预测详情:
  - 何立国: 真实=0, 预测=1, 置信度=0.501
  - 熊彦会: 真实=0, 预测=1, 置信度=0.546
  - 万强: 真实=1, 预测=0, 置信度=0.559
  - 李登华: 真实=0, 预测=1, 置信度=0.589
  - 梁啟华: 真实=0, 预测=1, 置信度=0.545
  - 周宏: 真实=1, 预测=0, 置信度=0.569
  - 肖发祥: 真实=1, 预测=0, 置信度=0.556
  - 田玉堂: 真实=0, 预测=1, 置信度=0.551
  - 王广礼: 真实=1, 预测=0, 置信度=0.566
  - 李双京: 真实=1, 预测=0, 置信度=0.502
  - 李忠信: 真实=0, 预测=1, 置信度=0.555
  - 吴德良: 真实=0, 预测=1, 置信度=0.507
  - 周燕来: 真实=1, 预测=0, 置信度=0.523
  - 俞双妹: 真实=1, 预测=0, 置信度=0.541
  - 顾文勇: 真实=0, 预测=1, 置信度=0.504
  - 谢宝康: 真实=1, 预测=0, 置信度=0.556

============================================================
测试集详细结果文件:
  - test_predictions_detailed.csv (所有样本)
  - test_predictions_errors.csv (仅错误预测)
============================================================

============================================================
训练完成！所有结果保存在: ./output_mask/train_mask_20251223_200307
============================================================