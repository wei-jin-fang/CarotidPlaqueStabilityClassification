ÊñπÊ°à1ÔºöÁâπÂæÅÂõæÁõ¥Êé•Êé©Á†ÅÔºàFeature MaskingÔºâ                                                                                                                                                                      
                                                                                                                                                                                                                
  ÂéüÁêÜÔºö                                                                                                                                                                                                        
  Âú®ResNetÊúÄÂêé‰∏ÄÂ±ÇÁâπÂæÅÂõæÔºàlayer4ËæìÂá∫Ôºâ‰∏äÁõ¥Êé•‰πò‰ª•mask                                                                                                                                                            
                                                                                                                                                                                                                
  ÂÆûÁé∞Ôºö                                                                                                                                                                                                        
  def forward(self, img, mask):                                                                                                                                                                                 
      x = self.conv1(img)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
      x = self.layer4(x)  # [B, 512, D', H', W']                                                                                                                                                                
                                                                                                                                                                                                                
      # Â∞Ümask‰∏ãÈááÊ†∑Âà∞ÁâπÂæÅÂõæÂ∞∫ÂØ∏                                                                                                                                                                                
      mask_resized = F.interpolate(mask, size=x.shape[2:], mode='trilinear', align_corners=False)                                                                                                               
                                                                                                                                                                                                                
      # Áõ¥Êé•Êé©Á†Å                                                                                                                                                                                                
      x = x * mask_resized  # ËÉåÊôØÁΩÆÈõ∂ÔºåÂè™‰øùÁïôROIÁâπÂæÅ                                                                                                                                                           
                                                                                                                                                                                                                
      x = self.avgpool(x)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
                                                                                                                                                                                                                
  ‰ºòÁÇπÔºö                                                                                                                                                                                                        
  - ÊúÄÁÆÄÂçïÁõ¥Êé•                                                                                                                                                                                                  
  - Âº∫Âà∂ËÅöÁÑ¶ROIÂå∫Âüü                                                                                                                                                                                             
  - ËÉåÊôØÂÆåÂÖ®Ë¢´ÊäëÂà∂                                                                                                                                                                                              
                                                                                                                                                                                                                
  Áº∫ÁÇπÔºö                                                                                                                                                                                                        
  - Á°¨Êà™Êñ≠ÔºåÂèØËÉΩÊçüÂ§±ËæπÁïå‰ø°ÊÅØ                                                                                                                                                                                    
  - maskËæπÁºòÂèØËÉΩ‰∫ßÁîüÁ™ÅÂèò                                                                                                                                                                                        
                                                                                                                                                                                                                
  ---                                                                                                                                                                                                           
  ÊñπÊ°à2ÔºöÂä†ÊùÉÂÖ®Â±ÄÂπ≥ÂùáÊ±†ÂåñÔºàWeighted GAPÔºâ                                                                                                                                                                       
                                                                                                                                                                                                                
  ÂéüÁêÜÔºö                                                                                                                                                                                                        
  Áî®mask‰Ωú‰∏∫ÊùÉÈáçËøõË°åÂä†ÊùÉÂπ≥ÂùáÊ±†ÂåñÔºåÊõø‰ª£Ê†áÂáÜÁöÑÂÖ®Â±ÄÂπ≥ÂùáÊ±†Âåñ                                                                                                                                                        
                                                                                                                                                                                                                
  ÂÆûÁé∞Ôºö                                                                                                                                                                                                        
  def forward(self, img, mask):                                                                                                                                                                                 
      x = self.conv1(img)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
      x = self.layer4(x)  # [B, 512, D', H', W']                                                                                                                                                                
                                                                                                                                                                                                                
      # Â∞Ümask‰∏ãÈááÊ†∑Âà∞ÁâπÂæÅÂõæÂ∞∫ÂØ∏                                                                                                                                                                                
      mask_resized = F.interpolate(mask, size=x.shape[2:], mode='trilinear', align_corners=False)                                                                                                               
                                                                                                                                                                                                                
      # Âä†ÊùÉÂπ≥ÂùáÊ±†ÂåñÔºàROIÂå∫ÂüüÊùÉÈáçÈ´òÔºåËÉåÊôØÂå∫ÂüüÊùÉÈáç‰ΩéÔºâ                                                                                                                                                           
      weighted_features = x * mask_resized                                                                                                                                                                      
      pooled = weighted_features.sum(dim=(2,3,4)) / (mask_resized.sum(dim=(2,3,4)) + 1e-6)                                                                                                                      
      # pooled: [B, 512]                                                                                                                                                                                        
                                                                                                                                                                                                                
      x = pooled.view(pooled.size(0), -1)                                                                                                                                                                       
      # ÂêéÁª≠Êé•ÂàÜÁ±ªÂ§¥                                                                                                                                                                                            
      ...                                                                                                                                                                                                       
                                                                                                                                                                                                                
  ‰ºòÁÇπÔºö                                                                                                                                                                                                        
  - ROIÂå∫ÂüüÊùÉÈáçÊõ¥È´ò                                                                                                                                                                                             
  - ‰øùÁïôÂÖ®Â±Ä‰ø°ÊÅØ                                                                                                                                                                                                
  - Êï∞ÂÄºÁ®≥ÂÆöÔºàÂΩí‰∏ÄÂåñÔºâ                                                                                                                                                                                          
                                                                                                                                                                                                                
  Áº∫ÁÇπÔºö                                                                                                                                                                                                        
  - ËÉåÊôØ‰ªçÊúâ‰∏ÄÂÆöÂΩ±Âìç                                                                                                                                                                                            
  - ÈúÄË¶ÅcarefulÂ§ÑÁêÜÈô§Èõ∂                                                                                                                                                                                         
                                                                                                                                                                                                                
  ---                                                                                                                                                                                                           
  ÊñπÊ°à3ÔºöÊ≥®ÊÑèÂäõÂä†ÊùÉÔºàSoft AttentionÔºâ                                                                                                                                                                           
                                                                                                                                                                                                                
  ÂéüÁêÜÔºö                                                                                                                                                                                                        
  Â∞ÜmaskÈÄöËøásigmoidÂ§ÑÁêÜÊàêËΩØÊ≥®ÊÑèÂäõÊùÉÈáçÔºåËøõË°åÂπ≥ÊªëÁöÑÁâπÂæÅÂä†ÊùÉ                                                                                                                                                       
                                                                                                                                                                                                                
  ÂÆûÁé∞Ôºö                                                                                                                                                                                                        
  def forward(self, img, mask):                                                                                                                                                                                 
      x = self.conv1(img)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
      x = self.layer4(x)  # [B, 512, D', H', W']                                                                                                                                                                
                                                                                                                                                                                                                
      # Â∞Ümask‰∏ãÈááÊ†∑Âà∞ÁâπÂæÅÂõæÂ∞∫ÂØ∏                                                                                                                                                                                
      mask_resized = F.interpolate(mask, size=x.shape[2:], mode='trilinear', align_corners=False)                                                                                                               
                                                                                                                                                                                                                
      # ÁîüÊàêËΩØÊ≥®ÊÑèÂäõÊùÉÈáçÔºàÂπ≥ÊªëÂ§ÑÁêÜÔºâ                                                                                                                                                                            
      attention_weight = torch.sigmoid(mask_resized * 10)  # ÊîæÂ§ßÂêésigmoidÔºå‰ΩøÂØπÊØîÊõ¥ÊòéÊòæ                                                                                                                        
                                                                                                                                                                                                                
      # ÁâπÂæÅÂä†ÊùÉ                                                                                                                                                                                                
      x = x * attention_weight                                                                                                                                                                                  
                                                                                                                                                                                                                
      x = self.avgpool(x)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
                                                                                                                                                                                                                
  ‰ºòÁÇπÔºö                                                                                                                                                                                                        
  - Âπ≥ÊªëÁöÑÊùÉÈáçÂàÜÂ∏É                                                                                                                                                                                              
  - ÈÅøÂÖçÁ°¨Êà™Êñ≠                                                                                                                                                                                                  
  - ËæπÁïåËøáÊ∏°Ëá™ÁÑ∂                                                                                                                                                                                                
                                                                                                                                                                                                                
  Áº∫ÁÇπÔºö                                                                                                                                                                                                        
  - ÈúÄË¶ÅË∞ÉÊï¥Áº©ÊîæÁ≥ªÊï∞                                                                                                                                                                                            
  - ËÉåÊôØ‰ªçÊúâÊÆãÁïôÂΩ±Âìç                                                                                                                                                                                            
                                                                                                                                                                                                                
  ---                                                                                                                                                                                                           
  ÊñπÊ°à4ÔºöROIÊ±†ÂåñÔºàROI-based PoolingÔºâ                                                                                                                                                                           
                                                                                                                                                                                                                
  ÂéüÁêÜÔºö                                                                                                                                                                                                        
  Âè™ÂØπmaskÂå∫ÂüüÂÜÖÁöÑÁâπÂæÅËøõË°åÊ±†ÂåñÔºåËÉåÊôØÂå∫ÂüüÂÆåÂÖ®ÂøΩÁï•                                                                                                                                                                
                                                                                                                                                                                                                
  ÂÆûÁé∞Ôºö                                                                                                                                                                                                        
  def forward(self, img, mask):                                                                                                                                                                                 
      x = self.conv1(img)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
      x = self.layer4(x)  # [B, 512, D', H', W']                                                                                                                                                                
                                                                                                                                                                                                                
      # Â∞Ümask‰∏ãÈááÊ†∑Âà∞ÁâπÂæÅÂõæÂ∞∫ÂØ∏                                                                                                                                                                                
      mask_resized = F.interpolate(mask, size=x.shape[2:], mode='trilinear', align_corners=False)                                                                                                               
                                                                                                                                                                                                                
      # ‰∫åÂÄºÂåñmask                                                                                                                                                                                              
      mask_binary = (mask_resized > 0.5).float()                                                                                                                                                                
                                                                                                                                                                                                                
      # Âè™Ê±†ÂåñROIÂå∫Âüü                                                                                                                                                                                           
      roi_features = x * mask_binary                                                                                                                                                                            
      roi_pooled = roi_features.sum(dim=(2,3,4)) / (mask_binary.sum(dim=(2,3,4)) + 1e-6)                                                                                                                        
      # roi_pooled: [B, 512]                                                                                                                                                                                    
                                                                                                                                                                                                                
      x = roi_pooled.view(roi_pooled.size(0), -1)                                                                                                                                                               
      ...                                                                                                                                                                                                       
                                                                                                                                                                                                                
  ‰ºòÁÇπÔºö                                                                                                                                                                                                        
  - ÂÆåÂÖ®ËÅöÁÑ¶ROI                                                                                                                                                                                                 
  - ËÉåÊôØÈõ∂ÂΩ±Âìç                                                                                                                                                                                                  
  - ËØ≠‰πâÊ∏ÖÊô∞                                                                                                                                                                                                    
                                                                                                                                                                                                                
  Áº∫ÁÇπÔºö                                                                                                                                                                                                        
  - Á°¨Êà™Êñ≠ÔºàÈòàÂÄº0.5Ôºâ                                                                                                                                                                                           
  - ÂèØËÉΩ‰∏¢Â§±ËæπÁïå‰ø°ÊÅØ                                                                                                                                                                                            
                                                                                                                                                                                                                
  ---                                                                                                                                                                                                           
  ÊñπÊ°à5ÔºöÈÄöÈÅìÁ∫ßÂä†ÊùÉÔºàChannel-wise WeightingÔºâ                                                                                                                                                                   
                                                                                                                                                                                                                
  ÂéüÁêÜÔºö                                                                                                                                                                                                        
  ÂØπÊØè‰∏™ÈÄöÈÅì‰ΩøÁî®maskËøõË°å‰∏çÂêåÁ®ãÂ∫¶ÁöÑÂä†ÊùÉ                                                                                                                                                                          
                                                                                                                                                                                                                
  ÂÆûÁé∞Ôºö                                                                                                                                                                                                        
  def forward(self, img, mask):                                                                                                                                                                                 
      x = self.conv1(img)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
      x = self.layer4(x)  # [B, 512, D', H', W']                                                                                                                                                                
                                                                                                                                                                                                                
      # Â∞Ümask‰∏ãÈááÊ†∑                                                                                                                                                                                            
      mask_resized = F.interpolate(mask, size=x.shape[2:], mode='trilinear', align_corners=False)                                                                                                               
                                                                                                                                                                                                                
      # ËÆ°ÁÆóÊØè‰∏™ÈÄöÈÅìÂú®ROIÂå∫ÂüüÁöÑÈáçË¶ÅÊÄß                                                                                                                                                                           
      channel_weight = (x * mask_resized).mean(dim=(2,3,4), keepdim=True)  # [B, 512, 1, 1, 1]                                                                                                                  
      channel_weight = torch.sigmoid(channel_weight)                                                                                                                                                            
                                                                                                                                                                                                                
      # ÈÄöÈÅìÂä†ÊùÉ + Á©∫Èó¥Êé©Á†Å                                                                                                                                                                                     
      x = x * channel_weight * mask_resized                                                                                                                                                                     
                                                                                                                                                                                                                
      x = self.avgpool(x)                                                                                                                                                                                       
      ...                                                                                                                                                                                                       
                                                                                                                                                                                                                
  ‰ºòÁÇπÔºö                                                                                                                                                                                                        
  - ÂêåÊó∂ËÄÉËôëÈÄöÈÅìÂíåÁ©∫Èó¥                                                                                                                                                                                          
  - Êõ¥Á≤æÁªÜÁöÑÁâπÂæÅÈÄâÊã©                                                                                                                                                                                            
  - Ëá™ÈÄÇÂ∫îÂä†ÊùÉ                                                                                                                                                                                                  
                                                                                                                                                                                                                
  Áº∫ÁÇπÔºö                                                                                                                                                                                                        
  - ËÆ°ÁÆóÁ®çÂ§çÊùÇ                                                                                                                                                                                                  
  - ‰∏§Ê¨°Âä†ÊùÉÂèØËÉΩËøáÂ∫¶ÊäëÂà∂                                                                                                                                                                                        
                                                                                                                                                                                                                
  ---                                                                                                                                                                                                           
  üìä ÊñπÊ°àÂØπÊØîË°®                                                                                                                                                                                                 
                                                                                                                                                                                                                
  | ÊñπÊ°à                | ÂÆûÁé∞ÈöæÂ∫¶ | ËÅöÁÑ¶Á®ãÂ∫¶   | Âπ≥ÊªëÂ∫¶     | ËÉåÊôØÊäëÂà∂   | Êé®ËçêÊåáÊï∞   |                                                                                                                        
  |---------------------|----------|------------|------------|------------|------------|                                                                                                                        
  | 1. ÁâπÂæÅÂõæÁõ¥Êé•Êé©Á†Å   | ‚≠ê       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê   |                                                                                                                        
  | 2. Âä†ÊùÉÂÖ®Â±ÄÂπ≥ÂùáÊ±†Âåñ | ‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |                                                                                                                        
  | 3. Ê≥®ÊÑèÂäõÂä†ÊùÉ       | ‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê‚≠ê   |                                                                                                                        
  | 4. ROIÊ±†Âåñ          | ‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê   |                                                                                                                        
  | 5. ÈÄöÈÅìÁ∫ßÂä†ÊùÉ       | ‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê     | ‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê     |                                                                                                                        
                                                                                                                                                                                                                
  üí° Êé®ËçêÊñπÊ°à                                                                                                                                                                                                   
                                                                                                                                                                                                                
  ÊàëÊúÄÊé®ËçêÊñπÊ°à2ÔºàÂä†ÊùÉÂÖ®Â±ÄÂπ≥ÂùáÊ±†ÂåñÔºâÔºåÁêÜÁî±Ôºö                                                                                                                                                                     
  1. ‚úÖ ÂÆûÁé∞ÁÆÄÂçïÔºå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁΩëÁªú                                                                                                                                                                                
  2. ‚úÖ ËÅöÁÑ¶ROIÁöÑÂêåÊó∂‰øùÁïôÂÖ®Â±Ä‰∏ä‰∏ãÊñá                                                                                                                                                                             
  3. ‚úÖ Êï∞ÂÄºÁ®≥ÂÆöÔºåÊúâÂΩí‰∏ÄÂåñ                                                                                                                                                                                      
  4. ‚úÖ Áâ©ÁêÜÊÑè‰πâÊ∏ÖÊô∞ÔºàÂä†ÊùÉÂπ≥ÂùáÔºâ                                                                                                                                                                                
  5. ‚úÖ ÂÆûÈ™åÊïàÊûúÈÄöÂ∏∏ÊúÄÂ•Ω                                                                                                                                                                                        
                                                                                                                                                                                                                
  Â¶ÇÊûúÊÉ≥Ë¶ÅÊõ¥Âº∫ÁöÑROIËÅöÁÑ¶ÔºåÈÄâÊñπÊ°à1ÊàñÊñπÊ°à4                                                                                                                                                                         
                                                                                                                                                                                                                
  ‰Ω†ÊÉ≥Áî®Âì™‰∏™ÊñπÊ°àÔºüÊàëÂèØ‰ª•Á´ãÂç≥Â∏Æ‰Ω†ÂÆûÁé∞ÔºÅÊàñËÄÖ‰Ω†ÊÉ≥ÂêåÊó∂ÂÆûÁé∞Âá†‰∏™ÊñπÊ°àÂÅöÊ∂àËûçÂÆûÈ™åÔºü